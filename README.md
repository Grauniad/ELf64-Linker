


Given the messy nature of dealing with "real" object files it has been necessary to expand the format definition from the book. Changes are listed here:

Symbols:
Some convention for empty symbol names is required. "__blank__" has been chosen

The symbol definition has an extra flag: "scope" tacked on to the end:
     G: Global
     L: Local 

In the books definition a symbol has two types, D and U, but the other types returned by readelf seem like they could be useful. Here is the current map from readelf to LINK (note: "D" has been abandoned, and is instead implied by a lack of "U"):
     U: NOTYPE
     F: FILE 
     S: SECTION
     O: OBJECT
     P: FUNC (mnemonic: PROC)
     


Segment Headers:
An alignment value (int) has been tacked on to the end of the segment header. Value is in bytes

There are now a whole bunch of extra flags. Here is the mapping from objdump to LINK:
     P: CONTENTS
     R: READABLE
     W: WRITEABLE (objdump has a read-only flag, the absensce of which is treated as a W flag)
     M: RELOC
     D: DATA
     C: CODE

Relocation:

whie the output of readelf and the huge output table in [1] are somewhat intimidating, it seems like this mess of information can actually be reduced right down. 

loc seg ref type add x86_type

loc: HEX offset within the segment seg to place the result
seg: Segment to place the result
ref: Where to find the input data. Depending on type this either a segment index (Name) or symbol (name)
type: How to handle this relocation entry, see below
add: Addendum to add to the value of symbol( Signed Hex)
x86_type: Type of relocation readelf reports this as. This is ignored by the linker, but may be used by link2elf to recover type information

type flags:

A: Absolute Reference
R: Relative Reference
S: ref is a symbol (by default ref is a segment NAME)
4: size of the value to relocate is 4 bytes
8: size of the value to relocate is 8 bytes
+: There is an addendum for this reloc entry


(U and L are currently not generated by els2link)

WARNING: the addendum convetion has changed from the book. In the book addendum values are retrieved from the location. Since the elf data structures (man elf) explicity define a field in the relcoation entry for the addendum value, and readelf reports it in place - the covention has been changed to read it directly out of the reloc entry, with the value at loc considered to be a filler value
Types: 



In addition to the information in the book I found these links useful:

[1] For more information than you could ever reasonably want to know abouy the elf format: (its not short - bring a cup of coffee): http://www.acsu.buffalo.edu/~charngda/elf.html

[2] A discussion on calculating the values of relocations: http://www.mindfruit.co.uk/2012/06/interpreting-readelf-r-in-this-case.html 

